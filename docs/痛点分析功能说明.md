# 痛点分析功能使用说明

## 功能概述

"Find Pain Points" 功能是一个**组合AI分析工具**，它能够：
1. 自动搜索Reddit上关于某个关键词的讨论
2. 使用AI分析用户痛点
3. 生成结构化的痛点分析报告

---

## 工作流程

```
用户输入关键词
    ↓
点击 "Find Pain Points" 按钮
    ↓
[步骤1] 调用 Serper API 搜索 Reddit (10条帖子)
    ↓
[步骤2] 提取标题、链接、摘要等数据
    ↓
[步骤3] 格式化为文本，构建AI提示词
    ↓
[步骤4] 调用腾讯ADP接口进行分析
    ↓
[步骤5] 解析AI返回的JSON结果
    ↓
[步骤6] 在 Executive Summary 位置显示分析结果
```

---

## 技术实现

### 1. API端点

**路径**: `/app/api/pain-points/analyze/route.ts`

**功能**: 
- 接收搜索关键词
- 调用Serper搜索Reddit
- 格式化Reddit数据
- 调用ADP分析
- 返回SSE流式响应

**请求格式**:
```typescript
POST /api/pain-points/analyze
{
  "query": "Notion",
  "platforms": ["reddit"]
}
```

**响应格式** (SSE流):
```typescript
// 事件1: 搜索中
event: status
data: {"status":"searching","message":"Searching Reddit posts...","progress":10}

// 事件2: 分析中
event: status
data: {"status":"analyzing","message":"Analyzing with AI...","progress":40}

// 事件3: ADP流式响应
event: adp_stream
data: {"content":"...","isFinal":false,"progress":60}

// 事件4: 完成
event: complete
data: {"status":"completed","result":"...","searchData":{...}}
```

---

### 2. 前端组件

#### **PainPointSearch** (`components/pain-point-search.tsx`)

**功能**:
- 搜索输入框
- 平台选择（Reddit/X）
- 调用分析API
- 显示实时进度
- 处理SSE流式响应

**核心方法**:
```typescript
const handleSearch = async () => {
  // 1. 发起API请求
  const response = await fetch('/api/pain-points/analyze', {
    method: 'POST',
    body: JSON.stringify({ query, platforms })
  });

  // 2. 处理SSE流
  const reader = response.body?.getReader();
  while (true) {
    const { done, value } = await reader.read();
    // 解析事件，更新进度和状态
  }
};
```

**状态管理**:
- `searchQuery`: 搜索关键词
- `isSearching`: 是否正在搜索
- `progress`: 进度百分比 (0-100)
- `analysisResult`: AI分析结果
- `redditPosts`: Reddit帖子数据
- `error`: 错误信息

---

#### **PainPointResults** (`components/pain-point-results.tsx`)

**功能**:
- 显示AI分析结果
- Executive Summary（执行摘要）
- Frustration Index（愤怒指数仪表盘）
- Pain Point Insights（痛点详情卡片）
- 复制报告/导出PDF功能

**Props接口**:
```typescript
interface PainPointResultsProps {
  data: {
    summary: string;           // AI生成的摘要
    frustrationScore: number;  // 0-100
    insights: Array<{
      title: string;
      severity: "High/Medium/Low Severity";
      category: string;
      description: string;
      opportunity: string;
      quote: string | null;
    }>;
  };
  redditPosts?: RedditPost[];  // Reddit原始数据
}
```

---

### 3. AI提示词模板

在 `/app/api/pain-points/analyze/route.ts` 中，我们构建了详细的提示词：

```typescript
const promptText = `
You are a product analyst specializing in identifying user pain points. 

I searched Reddit for "${query}" and found the following discussions. Please analyze these posts and provide:

1. **Executive Summary**: A concise summary (2-3 sentences) of the main frustrations users express about "${query}". Include the overall sentiment.

2. **Frustration Score**: Rate the overall frustration level from 0-100 (0 = satisfied, 100 = extremely frustrated).

3. **Top 3 Pain Points**: Identify the 3 most critical pain points with:
   - **Title**: Short, punchy description
   - **Severity**: High/Medium/Low
   - **Category**: Performance/UX/Feature Gap/Pricing/Support/Other
   - **Description**: What users are complaining about (1-2 sentences)
   - **Opportunity**: Actionable product improvement suggestion
   - **Quote**: An actual quote from the posts (if available)

Here are the Reddit posts:
[格式化的Reddit帖子数据]

Please respond in JSON format:
{
  "summary": "string",
  "frustrationScore": number,
  "insights": [...]
}
`;
```

---

## 数据流转

### 输入 → Serper
```typescript
{
  query: "Notion",
  num: 10,
  page: 1
}
```

### Serper → 格式化
```typescript
[
  {
    title: "Notion is too slow on mobile",
    link: "https://reddit.com/r/notion/...",
    snippet: "I love Notion but...",
    subreddit: "notion",
    date: "2 days ago"
  },
  // ... 更多帖子
]
```

### 格式化 → ADP
```
### Post 1
**Title**: Notion is too slow on mobile
**Subreddit**: r/notion
**Content Preview**: I love Notion but...
**Link**: https://reddit.com/...
---
```

### ADP → 前端
```json
{
  "summary": "Users mainly complain about slow mobile performance...",
  "frustrationScore": 78,
  "insights": [
    {
      "title": "Mobile App is too slow",
      "severity": "High Severity",
      "category": "Performance",
      "description": "Users report that the mobile app takes 10+ seconds to load...",
      "opportunity": "Build a lightweight version with offline-first architecture...",
      "quote": "I love the features but the app is unusable on my phone."
    }
  ]
}
```

---

## 使用方式

### 用户操作
1. 在首页搜索框输入关键词（如 "Notion"、"Email Marketing"）
2. 选择平台（默认Reddit）
3. 点击 "Find Pain Points" 按钮
4. 等待3-10秒（观看进度条）
5. 查看分析结果：
   - Executive Summary
   - Frustration Index
   - 3个痛点详情卡片
6. 可选：复制报告或导出PDF

### 示例关键词
- **产品名称**: "Notion", "Slack", "Trello"
- **领域**: "Email Marketing", "Remote Work", "Meal Prep"
- **功能**: "Project Management", "Time Tracking"

---

## 技术栈

- **前端**: React + TypeScript + Tailwind CSS
- **后端**: Next.js 15 App Router (Edge Runtime)
- **搜索API**: Serper.dev (Google Search)
- **AI分析**: 腾讯ADP (智能体开发平台)
- **通信协议**: Server-Sent Events (SSE)

---

## 错误处理

### 常见错误

1. **搜索失败**
   - 原因: Serper API密钥无效或配额超限
   - 处理: 显示错误提示，引导用户稍后重试

2. **分析失败**
   - 原因: ADP API错误或响应格式不正确
   - 处理: 使用原始文本作为summary，insights为空数组

3. **JSON解析失败**
   - 原因: ADP返回的不是标准JSON格式
   - 处理: 使用正则提取JSON，或使用原始文本

4. **网络超时**
   - 原因: 请求时间过长
   - 处理: 显示超时提示，允许重试

---

## 性能优化

### 1. 进度指示
- 搜索阶段: 0-40%
- 分析阶段: 40-90%
- 完成阶段: 90-100%

### 2. 流式响应
使用SSE而非轮询，实时更新进度和状态

### 3. 缓存策略
- 暂未实现，可以考虑缓存相同关键词的结果（5分钟）

### 4. 限流保护
- 客户端: 防止重复点击
- 服务端: 可添加速率限制（待实现）

---

## 扩展功能

### 待实现功能

1. **多平台支持**
   - 当前只支持Reddit
   - 计划支持X (Twitter)

2. **PDF导出**
   - 当前只有提示
   - 计划使用jsPDF生成PDF报告

3. **历史记录**
   - 保存用户的搜索历史和分析结果
   - 允许查看和比较历史数据

4. **高级过滤**
   - 时间范围过滤（最近一周/月）
   - 子版块过滤
   - 情感倾向过滤

5. **数据可视化**
   - 痛点趋势图
   - 词云图
   - 情感分析图表

---

## 文件清单

```
AI-SaaS/
├── app/
│   └── api/
│       └── pain-points/
│           └── analyze/
│               └── route.ts          # ⭐ API端点
├── components/
│   ├── pain-point-search.tsx         # ⭐ 搜索组件
│   ├── pain-point-results.tsx        # ⭐ 结果展示组件
│   ├── hero.tsx                      # 引用搜索组件
│   └── button.tsx                    # 按钮组件
├── lib/
│   └── services/
│       ├── serper.service.ts         # Serper API封装
│       └── adp.service.ts            # ADP API封装
└── docs/
    └── 痛点分析功能说明.md            # 本文档
```

---

## 调试技巧

### 1. 开启控制台日志
在浏览器开发者工具中查看：
```
[PainPointAnalyze] Starting analysis: { query, platforms }
[PainPointAnalyze] Search completed: { postsCount, total }
[PainPointAnalyze] Analysis completed
```

### 2. 检查网络请求
- 查看 `/api/pain-points/analyze` 请求
- 检查SSE事件流
- 查看响应时间

### 3. 测试ADP响应解析
```typescript
// 在浏览器控制台测试
const jsonStr = '{"summary":"test","frustrationScore":50,"insights":[]}';
JSON.parse(jsonStr);
```

---

## 常见问题

### Q1: 为什么只返回10条Reddit帖子？
**A**: 为了控制分析时间和Token消耗。可以在代码中调整`num`参数。

### Q2: AI分析需要多长时间？
**A**: 通常3-10秒，取决于：
- Serper搜索速度（~0.5秒）
- ADP分析速度（2-8秒）
- 网络延迟

### Q3: 如何提高分析质量？
**A**: 
- 使用更具体的关键词
- 增加搜索结果数量（修改`num`参数）
- 优化AI提示词模板
- 使用更高级的AI模型

### Q4: 可以分析中文内容吗？
**A**: 可以，但需要：
- 搜索中文关键词
- Reddit上存在相关中文讨论
- AI能够理解中文内容

---

## 总结

这个功能实现了**搜索 + AI分析**的完整闭环：

1. ✅ 自动搜索Reddit讨论
2. ✅ AI智能分析痛点
3. ✅ 结构化展示结果
4. ✅ 实时进度反馈
5. ✅ 支持报告导出

**核心价值**：帮助产品经理和创业者快速发现用户痛点，验证产品idea！

---

**文档版本**: v1.0  
**创建日期**: 2025-12-14  
**最后更新**: 2025-12-14
