# Serper.dev API å¯¹æ¥æ–‡æ¡£

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨Serper.devçš„Google Search APIæ¥æœç´¢Redditå†…å®¹ï¼Œæ›¿ä»£PRAWæ–¹æ¡ˆã€‚

**å®˜ç½‘**: https://serper.dev/  
**APIæ–‡æ¡£**: https://serper.dev/docs  
**ä¼˜åŠ¿**: æ— éœ€Reddit APIå®¡æ‰¹ï¼ŒåŸºäºGoogleæœç´¢ï¼Œçº¯TypeScriptå®ç°

---

## ä¸€ã€Serper.dev ç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯Serper.dev

Serper.devæ˜¯ä¸€ä¸ªé«˜é€ŸGoogleæœç´¢APIæœåŠ¡ï¼Œæä¾›ç»“æ„åŒ–çš„æœç´¢ç»“æœæ•°æ®ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- âš¡ è¶…å¿«å“åº”ï¼ˆ~0.3ç§’ï¼‰
- ğŸ¯ æ”¯æŒsite:è¿‡æ»¤ï¼ˆå¦‚site:reddit.comï¼‰
- ğŸ“Š è¿”å›ç»“æ„åŒ–JSONæ•°æ®
- ğŸ” æ”¯æŒå¤šç§æœç´¢ç±»å‹ï¼ˆwebã€imagesã€newsç­‰ï¼‰
- ğŸ’° å…è´¹é¢åº¦ï¼š2,500æ¬¡/æœˆ

### 1.2 å®šä»·æ–¹æ¡ˆ

| å¥—é¤ | ä»·æ ¼ | æœç´¢æ¬¡æ•° | é€‚ç”¨åœºæ™¯ |
|------|------|---------|---------|
| Free | $0 | 2,500æ¬¡/æœˆ | å¼€å‘æµ‹è¯• |
| Developer | $50/æœˆ | 50,000æ¬¡/æœˆ | å°å‹åº”ç”¨ |
| Business | $200/æœˆ | 250,000æ¬¡/æœˆ | ä¸­å‹åº”ç”¨ |
| Enterprise | è”ç³»é”€å”® | è‡ªå®šä¹‰ | å¤§å‹åº”ç”¨ |

**è®¡è´¹è¯´æ˜**: 
- æŒ‰å®é™…æœç´¢æ¬¡æ•°è®¡è´¹
- è¶…å‡ºé¢åº¦åæŒ‰$0.001/æ¬¡è®¡è´¹
- æ¯æœˆ1å·é‡ç½®é¢åº¦

---

## äºŒã€æ³¨å†Œå’Œé…ç½®

### 2.1 æ³¨å†Œè´¦å·

1. è®¿é—® https://serper.dev/
2. ç‚¹å‡» "Sign Up" æ³¨å†Œè´¦å·
3. ä½¿ç”¨Googleè´¦å·å¿«é€Ÿç™»å½•
4. éªŒè¯é‚®ç®±

### 2.2 è·å–APIå¯†é’¥

1. ç™»å½•åè¿›å…¥Dashboard
2. åœ¨Dashboardé¦–é¡µæ‰¾åˆ° "API Key" éƒ¨åˆ†
3. ç‚¹å‡» "Show API Key" æŸ¥çœ‹å¯†é’¥
4. ç‚¹å‡»å¤åˆ¶å›¾æ ‡å¤åˆ¶APIå¯†é’¥

**ç¤ºä¾‹APIå¯†é’¥æ ¼å¼**:
```
1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
```

### 2.3 é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`.env.local`æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
# Serper.dev APIé…ç½®
SERPER_API_KEY=your_serper_api_key_here
SERPER_API_URL=https://google.serper.dev/search

# å¯é€‰ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
SERPER_TIMEOUT=5000
```

**å®‰å…¨æç¤º**:
- âš ï¸ ä¸è¦å°†APIå¯†é’¥æäº¤åˆ°Gitä»“åº“
- âš ï¸ åœ¨`.gitignore`ä¸­ç¡®ä¿åŒ…å«`.env.local`
- âš ï¸ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æœåŠ¡

---

## ä¸‰ã€APIåŸºç¡€ä½¿ç”¨

### 3.1 åŸºæœ¬è¯·æ±‚ç»“æ„

```typescript
const response = await fetch('https://google.serper.dev/search', {
  method: 'POST',
  headers: {
    'X-API-KEY': 'your_api_key',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    q: 'site:reddit.com python programming',
    num: 10,
  }),
});

const data = await response.json();
```

### 3.2 è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| q | string | æ˜¯ | æœç´¢æŸ¥è¯¢è¯ | "python tips" |
| num | number | å¦ | è¿”å›ç»“æœæ•°é‡ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100 | 25 |
| page | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼Œæœ€å¤§10 | 1 |
| gl | string | å¦ | å›½å®¶ä»£ç  | "us" |
| hl | string | å¦ | è¯­è¨€ä»£ç  | "en" |
| autocorrect | boolean | å¦ | è‡ªåŠ¨çº é”™ï¼Œé»˜è®¤true | true |
| tbs | string | å¦ | æ—¶é—´èŒƒå›´è¿‡æ»¤ | "qdr:d"ï¼ˆæœ€è¿‘ä¸€å¤©ï¼‰ |

### 3.3 å“åº”ç»“æ„

```typescript
{
  "searchParameters": {
    "q": "site:reddit.com python programming",
    "num": 10,
    "type": "search"
  },
  "organic": [
    {
      "position": 1,
      "title": "Best Python tips for beginners",
      "link": "https://reddit.com/r/Python/comments/abc123/...",
      "snippet": "Here are some great Python tips...",
      "date": "2 days ago",
      "domain": "reddit.com"
    }
    // ... more results
  ],
  "searchInformation": {
    "totalResults": "1,234,567",
    "timeTaken": 0.35,
    "organic_results_state": "Results for exact spelling"
  }
}
```

---

## å››ã€Redditæœç´¢å®ç°

### 4.1 åˆ›å»ºSerper Service

`lib/services/serper.service.ts`:

```typescript
/**
 * Serper.dev APIå®¢æˆ·ç«¯
 * ç”¨äºæœç´¢Redditå†…å®¹
 */

const SERPER_API_URL = process.env.SERPER_API_URL || 'https://google.serper.dev/search';
const SERPER_API_KEY = process.env.SERPER_API_KEY!;
const SERPER_TIMEOUT = parseInt(process.env.SERPER_TIMEOUT || '5000');

export interface SerperSearchParams {
  query: string;
  num?: number;
  page?: number;
  gl?: string; // å›½å®¶ä»£ç 
  hl?: string; // è¯­è¨€ä»£ç 
}

export interface RedditPost {
  title: string;
  link: string;
  snippet: string;
  date?: string;
  subreddit?: string;
  position: number;
  domain: string;
}

export interface SerperSearchResult {
  posts: RedditPost[];
  total: number;
  searchTime: number;
  query: string;
}

export class SerperService {
  
  /**
   * æœç´¢Redditå¸–å­
   */
  static async searchReddit(params: SerperSearchParams): Promise<SerperSearchResult> {
    const { query, num = 25, page = 1, gl = 'us', hl = 'en' } = params;
    
    if (!query || query.trim().length === 0) {
      throw new Error('Search query is required');
    }
    
    if (!SERPER_API_KEY) {
      throw new Error('SERPER_API_KEY is not configured');
    }
    
    try {
      // æ„å»ºæœç´¢æŸ¥è¯¢ï¼Œé™å®šåœ¨Redditç«™ç‚¹
      const searchQuery = `site:reddit.com ${query.trim()}`;
      
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), SERPER_TIMEOUT);
      
      const response = await fetch(SERPER_API_URL, {
        method: 'POST',
        headers: {
          'X-API-KEY': SERPER_API_KEY,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          q: searchQuery,
          num: Math.min(num, 100), // é™åˆ¶æœ€å¤š100æ¡
          page,
          gl,
          hl,
          autocorrect: true,
        }),
        signal: controller.signal,
      });
      
      clearTimeout(timeoutId);

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Serper API error: ${response.status} - ${errorText}`);
      }

      const data = await response.json();
      
      // è§£æç»“æœ
      const posts = this.parseSearchResults(data);
      
      return {
        posts,
        total: this.parseTotalResults(data.searchInformation?.totalResults),
        searchTime: data.searchInformation?.timeTaken || 0,
        query: query,
      };

    } catch (error) {
      if (error.name === 'AbortError') {
        throw new Error('Search request timeout');
      }
      console.error('Serper search error:', error);
      throw new Error(error instanceof Error ? error.message : 'Search failed');
    }
  }

  /**
   * æœç´¢æŒ‡å®šå­ç‰ˆå—çš„å¸–å­
   */
  static async searchSubreddit(
    subreddit: string,
    query?: string,
    num: number = 25
  ): Promise<SerperSearchResult> {
    if (!subreddit || subreddit.trim().length === 0) {
      throw new Error('Subreddit name is required');
    }
    
    // ç§»é™¤r/å‰ç¼€ï¼ˆå¦‚æœæœ‰ï¼‰
    const cleanSubreddit = subreddit.replace(/^r\//, '').trim();
    
    // æ„å»ºå­ç‰ˆå—æœç´¢
    const searchQuery = query && query.trim()
      ? `site:reddit.com/r/${cleanSubreddit} ${query.trim()}`
      : `site:reddit.com/r/${cleanSubreddit}`;
    
    return this.searchReddit({ query: searchQuery, num });
  }

  /**
   * è§£æSerperè¿”å›çš„æœç´¢ç»“æœ
   */
  private static parseSearchResults(data: any): RedditPost[] {
    const organic = data.organic || [];
    
    return organic.map((result: any, index: number) => {
      // ä»URLä¸­æå–å­ç‰ˆå—åç§°
      const subredditMatch = result.link?.match(/reddit\.com\/r\/([^\/]+)/);
      const subreddit = subredditMatch ? subredditMatch[1] : null;
      
      return {
        title: result.title || 'Untitled',
        link: result.link || '',
        snippet: result.snippet || '',
        date: result.date || null,
        subreddit,
        position: result.position || index + 1,
        domain: result.domain || 'reddit.com',
      };
    }).filter(post => post.link); // è¿‡æ»¤æ‰æ²¡æœ‰é“¾æ¥çš„ç»“æœ
  }

  /**
   * è§£ææ€»ç»“æœæ•°é‡
   */
  private static parseTotalResults(totalStr?: string): number {
    if (!totalStr) return 0;
    // ç§»é™¤é€—å·ï¼Œè½¬æ¢ä¸ºæ•°å­—
    const num = parseInt(totalStr.replace(/,/g, ''));
    return isNaN(num) ? 0 : num;
  }

  /**
   * è·å–å•ä¸ªRedditå¸–å­è¯¦æƒ…ï¼ˆé€šè¿‡URLï¼‰
   */
  static async getPostByUrl(postUrl: string): Promise<RedditPost | null> {
    if (!postUrl) {
      throw new Error('Post URL is required');
    }
    
    try {
      const response = await fetch(SERPER_API_URL, {
        method: 'POST',
        headers: {
          'X-API-KEY': SERPER_API_KEY,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          q: `site:${postUrl}`,
          num: 1,
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to fetch post details');
      }

      const data = await response.json();
      const posts = this.parseSearchResults(data);
      
      return posts[0] || null;

    } catch (error) {
      console.error('Get post error:', error);
      return null;
    }
  }
}
```

### 4.2 TypeScriptç±»å‹å®šä¹‰

`types/serper.ts`:

```typescript
export interface SerperSearchParams {
  query: string;
  num?: number;
  page?: number;
  gl?: string;
  hl?: string;
}

export interface RedditPost {
  title: string;
  link: string;
  snippet: string;
  date?: string;
  subreddit?: string;
  position: number;
  domain: string;
}

export interface SerperSearchResult {
  posts: RedditPost[];
  total: number;
  searchTime: number;
  query: string;
}

export interface SerperAPIResponse {
  searchParameters: {
    q: string;
    num: number;
    type: string;
  };
  organic: Array<{
    position: number;
    title: string;
    link: string;
    snippet: string;
    date?: string;
    domain: string;
  }>;
  searchInformation: {
    totalResults: string;
    timeTaken: number;
    organic_results_state: string;
  };
}
```

---

## äº”ã€Next.js APIé›†æˆ

### 5.1 æœç´¢APIè·¯ç”±

`app/api/reddit/search/route.ts`:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { SerperService } from '@/lib/services/serper.service';
import { verifyAuth } from '@/lib/auth';
import { checkQuota, decrementQuota } from '@/lib/services/quota.service';

export async function POST(req: NextRequest) {
  try {
    // 1. éªŒè¯ç”¨æˆ·è®¤è¯
    const user = await verifyAuth(req);
    if (!user) {
      return NextResponse.json(
        { error: 'Unauthorized. Please login.' },
        { status: 401 }
      );
    }
    
    // 2. æ£€æŸ¥é…é¢
    const hasQuota = await checkQuota(user.id);
    if (!hasQuota) {
      return NextResponse.json(
        { 
          error: 'Daily quota exceeded. Please upgrade to premium.',
          code: 'QUOTA_EXCEEDED'
        },
        { status: 429 }
      );
    }
    
    // 3. è·å–æœç´¢å‚æ•°
    const body = await req.json();
    const { query, num = 25, page = 1 } = body;
    
    if (!query || query.trim().length === 0) {
      return NextResponse.json(
        { error: 'Query parameter is required' },
        { status: 400 }
      );
    }
    
    // 4. è°ƒç”¨Serperæœç´¢
    const result = await SerperService.searchReddit({
      query: query.trim(),
      num: Math.min(num, 25), // é™åˆ¶æœ€å¤š25æ¡
      page,
    });
    
    // 5. æ‰£å‡é…é¢
    await decrementQuota(user.id);
    
    // 6. è®°å½•æœç´¢å†å²ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡å“åº”ï¼‰
    // saveSearchHistory(user.id, query, 'reddit').catch(console.error);
    
    return NextResponse.json({
      success: true,
      data: result.posts,
      total: result.total,
      searchTime: result.searchTime,
      query: result.query,
    });
    
  } catch (error) {
    console.error('Reddit search error:', error);
    
    // åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯
    if (error instanceof Error) {
      if (error.message.includes('timeout')) {
        return NextResponse.json(
          { error: 'Search timeout. Please try again.' },
          { status: 504 }
        );
      }
      if (error.message.includes('SERPER_API_KEY')) {
        return NextResponse.json(
          { error: 'Service configuration error.' },
          { status: 500 }
        );
      }
    }
    
    return NextResponse.json(
      { error: 'Search failed. Please try again later.' },
      { status: 500 }
    );
  }
}
```

### 5.2 å­ç‰ˆå—æœç´¢API

`app/api/reddit/subreddit/[name]/route.ts`:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { SerperService } from '@/lib/services/serper.service';
import { verifyAuth } from '@/lib/auth';
import { checkQuota, decrementQuota } from '@/lib/services/quota.service';

export async function GET(
  req: NextRequest,
  { params }: { params: { name: string } }
) {
  try {
    // 1. éªŒè¯è®¤è¯
    const user = await verifyAuth(req);
    if (!user) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }
    
    // 2. æ£€æŸ¥é…é¢
    const hasQuota = await checkQuota(user.id);
    if (!hasQuota) {
      return NextResponse.json(
        { error: 'Daily quota exceeded' },
        { status: 429 }
      );
    }
    
    // 3. è·å–å­ç‰ˆå—åç§°å’Œå¯é€‰æŸ¥è¯¢
    const { name } = params;
    const { searchParams } = new URL(req.url);
    const query = searchParams.get('query') || '';
    const num = parseInt(searchParams.get('num') || '25');
    
    if (!name || name.trim().length === 0) {
      return NextResponse.json(
        { error: 'Subreddit name is required' },
        { status: 400 }
      );
    }
    
    // 4. æœç´¢å­ç‰ˆå—
    const result = await SerperService.searchSubreddit(
      name,
      query,
      Math.min(num, 25)
    );
    
    // 5. æ‰£å‡é…é¢
    await decrementQuota(user.id);
    
    return NextResponse.json({
      success: true,
      data: result.posts,
      total: result.total,
      subreddit: name,
    });
    
  } catch (error) {
    console.error('Subreddit search error:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'Search failed' },
      { status: 500 }
    );
  }
}
```

---

## å…­ã€å‰ç«¯å®ç°

### 6.1 æœç´¢é¡µé¢ç»„ä»¶

`app/(dashboard)/reddit-search/page.tsx`:

```typescript
'use client';

import { useState } from 'react';
import { Search, ExternalLink, TrendingUp, Loader2 } from 'lucide-react';

interface RedditPost {
  title: string;
  link: string;
  snippet: string;
  date?: string;
  subreddit?: string;
  position: number;
}

const POPULAR_SUBREDDITS = [
  'python', 'javascript', 'webdev', 'programming',
  'technology', 'gaming', 'fitness', 'cooking'
];

export default function RedditSearchPage() {
  const [query, setQuery] = useState('');
  const [subreddit, setSubreddit] = useState('');
  const [results, setResults] = useState<RedditPost[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [searchInfo, setSearchInfo] = useState<{
    total: number;
    searchTime: number;
  } | null>(null);

  const handleSearch = async () => {
    if (!query.trim() && !subreddit.trim()) {
      setError('Please enter a search query or select a subreddit');
      return;
    }

    setLoading(true);
    setError('');
    setResults([]);
    setSearchInfo(null);

    try {
      let endpoint: string;
      let options: RequestInit;

      if (subreddit.trim()) {
        // æœç´¢ç‰¹å®šå­ç‰ˆå—
        const queryParam = query ? `?query=${encodeURIComponent(query)}` : '';
        endpoint = `/api/reddit/subreddit/${subreddit}${queryParam}`;
        options = { method: 'GET' };
      } else {
        // å…¨ç«™æœç´¢
        endpoint = '/api/reddit/search';
        options = {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query }),
        };
      }

      const response = await fetch(endpoint, options);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Search failed');
      }

      setResults(data.data || []);
      setSearchInfo({
        total: data.total || 0,
        searchTime: data.searchTime || 0,
      });

    } catch (err) {
      setError(err instanceof Error ? err.message : 'Search failed');
      setResults([]);
    } finally {
      setLoading(false);
    }
  };

  const handleSubredditClick = (sub: string) => {
    setSubreddit(sub);
    setQuery('');
  };

  return (
    <div className="container mx-auto px-4 py-8 max-w-5xl">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-4xl font-bold mb-2">Reddit Search</h1>
        <p className="text-gray-600">
          Search Reddit posts powered by Google Search
        </p>
      </div>

      {/* Search Form */}
      <div className="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
        <div className="space-y-4">
          {/* Query Input */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Search Query
            </label>
            <input
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
              placeholder="Enter keywords..."
              className="w-full px-4 py-3 border border-gray-300 rounded-lg 
                focus:ring-2 focus:ring-blue-500 focus:border-transparent
                dark:bg-gray-700 dark:border-gray-600"
              disabled={loading}
            />
          </div>

          {/* Subreddit Input */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Subreddit (optional)
            </label>
            <input
              type="text"
              value={subreddit}
              onChange={(e) => setSubreddit(e.target.value)}
              placeholder="e.g., python, webdev"
              className="w-full px-4 py-3 border border-gray-300 rounded-lg
                focus:ring-2 focus:ring-blue-500 focus:border-transparent
                dark:bg-gray-700 dark:border-gray-600"
              disabled={loading}
            />
          </div>

          {/* Popular Subreddits */}
          <div>
            <label className="block text-sm font-medium mb-2">
              <TrendingUp className="inline w-4 h-4 mr-1" />
              Popular Subreddits
            </label>
            <div className="flex flex-wrap gap-2">
              {POPULAR_SUBREDDITS.map((sub) => (
                <button
                  key={sub}
                  onClick={() => handleSubredditClick(sub)}
                  className="px-3 py-1 bg-gray-100 hover:bg-gray-200 
                    dark:bg-gray-700 dark:hover:bg-gray-600
                    rounded-full text-sm transition-colors"
                  disabled={loading}
                >
                  r/{sub}
                </button>
              ))}
            </div>
          </div>

          {/* Search Button */}
          <button
            onClick={handleSearch}
            disabled={loading}
            className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg 
              hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed
              flex items-center justify-center gap-2 font-medium
              transition-colors"
          >
            {loading ? (
              <>
                <Loader2 size={20} className="animate-spin" />
                Searching...
              </>
            ) : (
              <>
                <Search size={20} />
                Search Reddit
              </>
            )}
          </button>
        </div>
      </div>

      {/* Error Message */}
      {error && (
        <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 
          dark:border-red-800 text-red-700 dark:text-red-400 
          px-4 py-3 rounded-lg mb-6">
          {error}
        </div>
      )}

      {/* Search Info */}
      {searchInfo && (
        <div className="text-sm text-gray-600 dark:text-gray-400 mb-4">
          Found approximately {searchInfo.total.toLocaleString()} results 
          in {searchInfo.searchTime.toFixed(2)} seconds
        </div>
      )}

      {/* Search Results */}
      {results.length > 0 && (
        <div className="space-y-4">
          {results.map((post, index) => (
            <div
              key={index}
              className="bg-white dark:bg-gray-800 rounded-lg shadow-md 
                hover:shadow-xl transition-shadow p-6"
            >
              {/* Subreddit Badge */}
              {post.subreddit && (
                <div className="mb-2">
                  <span className="inline-block px-3 py-1 bg-blue-100 
                    dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 
                    text-xs font-medium rounded-full">
                    r/{post.subreddit}
                  </span>
                </div>
              )}

              {/* Title */}
              <a
                href={post.link}
                target="_blank"
                rel="noopener noreferrer"
                className="text-xl font-semibold text-blue-600 
                  dark:text-blue-400 hover:underline 
                  flex items-start gap-2 group"
              >
                <span className="flex-1">{post.title}</span>
                <ExternalLink 
                  size={18} 
                  className="mt-1 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity" 
                />
              </a>

              {/* Snippet */}
              <p className="text-gray-700 dark:text-gray-300 mt-3 leading-relaxed">
                {post.snippet}
              </p>

              {/* Meta Info */}
              <div className="mt-3 flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                {post.date && (
                  <span>{post.date}</span>
                )}
                <span>Position: #{post.position}</span>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* Empty State */}
      {!loading && results.length === 0 && !error && (
        <div className="text-center py-16">
          <Search size={64} className="mx-auto text-gray-300 dark:text-gray-600 mb-4" />
          <p className="text-gray-500 dark:text-gray-400 text-lg">
            Enter a search query to find Reddit posts
          </p>
        </div>
      )}
    </div>
  );
}
```

---

## ä¸ƒã€é«˜çº§æœç´¢æŠ€å·§

### 7.1 æœç´¢è¿ç®—ç¬¦

Serper.devæ”¯æŒGoogleæœç´¢è¿ç®—ç¬¦ï¼š

```typescript
// ç²¾ç¡®åŒ¹é…
q: 'site:reddit.com "python tips"'

// æ’é™¤å…³é”®è¯
q: 'site:reddit.com python -django'

// ORè¿ç®—ç¬¦
q: 'site:reddit.com python OR javascript'

// æ—¶é—´èŒƒå›´ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰
q: 'site:reddit.com python',
tbs: 'qdr:d'

// æ—¶é—´èŒƒå›´é€‰é¡¹
// qdr:h - æœ€è¿‘1å°æ—¶
// qdr:d - æœ€è¿‘1å¤©
// qdr:w - æœ€è¿‘1å‘¨
// qdr:m - æœ€è¿‘1æœˆ
// qdr:y - æœ€è¿‘1å¹´
```

### 7.2 å­ç‰ˆå—ç‰¹å®šæœç´¢

```typescript
// æœç´¢ç‰¹å®šå­ç‰ˆå—
const result = await SerperService.searchReddit({
  query: 'site:reddit.com/r/python async programming'
});

// æˆ–ä½¿ç”¨ä¸“ç”¨æ–¹æ³•
const result = await SerperService.searchSubreddit('python', 'async programming');
```

### 7.3 å¤šå­ç‰ˆå—æœç´¢

```typescript
// æœç´¢å¤šä¸ªå­ç‰ˆå—
const query = '(site:reddit.com/r/python OR site:reddit.com/r/javascript) async';
const result = await SerperService.searchReddit({ query });
```

---

## å…«ã€é”™è¯¯å¤„ç†

### 8.1 å¸¸è§é”™è¯¯ä»£ç 

| çŠ¶æ€ç  | é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|--------|------|------|---------|
| 401 | Unauthorized | APIå¯†é’¥æ— æ•ˆæˆ–ç¼ºå¤± | æ£€æŸ¥SERPER_API_KEYé…ç½® |
| 429 | Rate Limit | è¶…å‡ºAPIè°ƒç”¨é™åˆ¶ | å‡çº§å¥—é¤æˆ–ç­‰å¾…é‡ç½® |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚æ ¼å¼ |
| 500 | Internal Error | SerperæœåŠ¡å™¨é”™è¯¯ | ç¨åé‡è¯• |
| 504 | Timeout | è¯·æ±‚è¶…æ—¶ | å¢åŠ è¶…æ—¶æ—¶é—´æˆ–é‡è¯• |

### 8.2 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```typescript
try {
  const result = await SerperService.searchReddit({ query });
  return result;
} catch (error) {
  if (error instanceof Error) {
    // APIé…ç½®é”™è¯¯
    if (error.message.includes('SERPER_API_KEY')) {
      console.error('Serper API key not configured');
      throw new Error('Search service not available');
    }
    
    // è¶…æ—¶é”™è¯¯
    if (error.message.includes('timeout')) {
      console.error('Search timeout');
      throw new Error('Search took too long, please try again');
    }
    
    // é€Ÿç‡é™åˆ¶
    if (error.message.includes('429')) {
      console.error('Rate limit exceeded');
      throw new Error('Too many requests, please try again later');
    }
  }
  
  // é€šç”¨é”™è¯¯
  throw new Error('Search failed, please try again');
}
```

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 ç¼“å­˜ç­–ç•¥

```typescript
import { LRUCache } from 'lru-cache';

// åˆ›å»ºç¼“å­˜ï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰
const cache = new LRUCache<string, SerperSearchResult>({
  max: 100,
  ttl: 1000 * 60 * 5, // 5åˆ†é’Ÿ
});

export class SerperService {
  static async searchReddit(params: SerperSearchParams): Promise<SerperSearchResult> {
    // ç”Ÿæˆç¼“å­˜é”®
    const cacheKey = JSON.stringify(params);
    
    // æ£€æŸ¥ç¼“å­˜
    const cached = cache.get(cacheKey);
    if (cached) {
      return cached;
    }
    
    // æ‰§è¡Œæœç´¢
    const result = await this.performSearch(params);
    
    // å­˜å…¥ç¼“å­˜
    cache.set(cacheKey, result);
    
    return result;
  }
}
```

### 9.2 è¯·æ±‚é™æµ

```typescript
import pLimit from 'p-limit';

// é™åˆ¶å¹¶å‘è¯·æ±‚æ•°
const limit = pLimit(5);

const searches = ['query1', 'query2', 'query3'];
const results = await Promise.all(
  searches.map(query => 
    limit(() => SerperService.searchReddit({ query }))
  )
);
```

---

## åã€ç›‘æ§å’Œæ—¥å¿—

### 10.1 è¯·æ±‚æ—¥å¿—

```typescript
export class SerperService {
  static async searchReddit(params: SerperSearchParams): Promise<SerperSearchResult> {
    const startTime = Date.now();
    
    try {
      console.log('[Serper] Search started:', {
        query: params.query,
        num: params.num,
      });
      
      const result = await this.performSearch(params);
      
      const duration = Date.now() - startTime;
      console.log('[Serper] Search completed:', {
        query: params.query,
        resultsCount: result.posts.length,
        duration: `${duration}ms`,
      });
      
      return result;
    } catch (error) {
      const duration = Date.now() - startTime;
      console.error('[Serper] Search failed:', {
        query: params.query,
        duration: `${duration}ms`,
        error: error instanceof Error ? error.message : 'Unknown error',
      });
      throw error;
    }
  }
}
```

### 10.2 ä½¿ç”¨é‡ç›‘æ§

å®šæœŸæ£€æŸ¥APIä½¿ç”¨é‡ï¼š

```typescript
// è®°å½•æ¯æ¬¡æœç´¢
async function logAPIUsage(userId: string, query: string) {
  await db.apiUsage.create({
    data: {
      userId,
      service: 'serper',
      query,
      timestamp: new Date(),
    },
  });
}

// ç»Ÿè®¡æœˆåº¦ä½¿ç”¨é‡
async function getMonthlyUsage() {
  const count = await db.apiUsage.count({
    where: {
      service: 'serper',
      timestamp: {
        gte: new Date(new Date().getFullYear(), new Date().getMonth(), 1),
      },
    },
  });
  
  console.log(`Serper API calls this month: ${count} / 2500`);
  return count;
}
```

---

## åä¸€ã€ä¸PRAWæ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | PRAWæ–¹æ¡ˆ | Serper.devæ–¹æ¡ˆ |
|------|----------|----------------|
| **è®¾ç½®å¤æ‚åº¦** | ğŸ”´ éœ€è¦Redditå®¡æ‰¹ | ğŸŸ¢ ç«‹å³å¯ç”¨ |
| **æŠ€æœ¯æ ˆ** | ğŸ”´ éœ€è¦Pythonåç«¯ | ğŸŸ¢ çº¯TypeScript |
| **ç»´æŠ¤æˆæœ¬** | ğŸ”´ éœ€ç»´æŠ¤PythonæœåŠ¡ | ğŸŸ¢ æ— é¢å¤–æœåŠ¡ |
| **æœç´¢èƒ½åŠ›** | ğŸŸ¡ Reddit APIé™åˆ¶ | ğŸŸ¢ Googleçº§åˆ«æœç´¢ |
| **æ•°æ®å®Œæ•´æ€§** | ğŸŸ¢ å®Œæ•´çš„Redditæ•°æ® | ğŸŸ¡ åŸºäºGoogleç´¢å¼• |
| **è¯„è®ºè·å–** | ğŸŸ¢ å®Œæ•´è¯„è®ºæ ‘ | ğŸ”´ ä¸æ”¯æŒï¼ˆéœ€é¢å¤–æ–¹æ¡ˆï¼‰ |
| **æˆæœ¬** | ğŸŸ¢ å…è´¹ | ğŸŸ¡ 2500æ¬¡/æœˆå…è´¹ |
| **é€Ÿåº¦** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ å¿«é€Ÿ(~0.3s) |
| **éƒ¨ç½²** | ğŸ”´ éœ€Docker/å®¹å™¨ | ğŸŸ¢ Serverlesså‹å¥½ |

---

## åäºŒã€å¸¸è§é—®é¢˜

### Q1: Serper.devå¦‚ä½•è®¡è´¹ï¼Ÿ
**ç­”**: æŒ‰å®é™…æœç´¢æ¬¡æ•°è®¡è´¹ï¼Œæ¯ä¸ªPOSTè¯·æ±‚è®¡ä¸º1æ¬¡æœç´¢ã€‚å…è´¹è´¦æˆ·æœ‰2500æ¬¡/æœˆé¢åº¦ã€‚

### Q2: å¯ä»¥è·å–Redditè¯„è®ºå—ï¼Ÿ
**ç­”**: Serper.devåªè¿”å›å¸–å­ä¿¡æ¯ï¼Œä¸åŒ…å«è¯„è®ºã€‚å¦‚éœ€è¯„è®ºï¼Œå¯ä»¥ï¼š
- å¼•å¯¼ç”¨æˆ·ç‚¹å‡»é“¾æ¥åˆ°RedditæŸ¥çœ‹
- ä½¿ç”¨Redditçš„JSON APIï¼ˆæ— éœ€è®¤è¯ï¼‰è·å–è¯„è®º
- ç»“åˆPRAWä½¿ç”¨ï¼ˆä»…è·å–è¯„è®ºï¼‰

### Q3: æœç´¢ç»“æœå®æ—¶å—ï¼Ÿ
**ç­”**: åŸºäºGoogleç´¢å¼•ï¼Œé€šå¸¸æœ‰å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶çš„å»¶è¿Ÿï¼Œä½†å¤§éƒ¨åˆ†å†…å®¹æ˜¯å®æ—¶çš„ã€‚

### Q4: å¦‚ä½•ä¼˜åŒ–æœç´¢è´¨é‡ï¼Ÿ
**ç­”**: 
- ä½¿ç”¨ç²¾ç¡®çš„å…³é”®è¯
- ä½¿ç”¨å¼•å·è¿›è¡Œç²¾ç¡®åŒ¹é…
- ä½¿ç”¨æ’é™¤è¿ç®—ç¬¦(-å…³é”®è¯)
- é™å®šæ—¶é—´èŒƒå›´(tbså‚æ•°)

### Q5: APIå¯†é’¥å®‰å…¨å—ï¼Ÿ
**ç­”**: APIå¯†é’¥ä»…åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œä¸æš´éœ²ç»™å‰ç«¯ã€‚ç¡®ä¿ï¼š
- ä½¿ç”¨ç¯å¢ƒå˜é‡
- ä¸æäº¤åˆ°Git
- å®šæœŸè½®æ¢å¯†é’¥

---

## åä¸‰ã€ç›¸å…³èµ„æº

- **Serper.devå®˜ç½‘**: https://serper.dev/
- **APIæ–‡æ¡£**: https://serper.dev/docs
- **Playground**: https://serper.dev/playground
- **å®šä»·**: https://serper.dev/pricing
- **æ”¯æŒ**: support@serper.dev

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-13  
**ç»´æŠ¤è€…**: AI-SaaSå¼€å‘å›¢é˜Ÿ
